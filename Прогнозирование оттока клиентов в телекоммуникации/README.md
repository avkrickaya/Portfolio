# Прогнозирование оттока клиентов в телекоммуникации

## Содержание
1.	[Описание задачи](https://github.com/avkrickaya/Portfolio/edit/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#описание-задачи)
2.	[Описание услуг](https://github.com/avkrickaya/Portfolio/edit/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#описание-услуг)
3.	[Описание данных](https://github.com/avkrickaya/Portfolio/edit/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#описание-данных)
4.	[Описание полей](https://github.com/avkrickaya/Portfolio/edit/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#описание-полей)
5.	[Используемые инструменты](https://github.com/avkrickaya/Portfolio/blob/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#используемые-инструменты)
6.	[План работы](https://github.com/avkrickaya/Portfolio/blob/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#план-работы)
7.	[Вывод](https://github.com/avkrickaya/Portfolio/blob/main/Прогнозирование%20оттока%20клиентов%20в%20телекоммуникации/README.md#вывод)
   
## Описание задачи

Оператор связи хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.


## Описание услуг

Оператор предоставляет два основных типа услуг:
1.	Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
2.	Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic).


Также доступны такие услуги:


* Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity);
* Выделенная линия технической поддержки (TechSupport);
* Облачное хранилище файлов для резервного копирования данных (OnlineBackup);
* Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies).
	

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.


## Описание данных

Данные состоят из файлов, полученных из разных источников:

* contract_new.csv — информация о договоре;
* personal_new.csv — персональные данные клиента;
* internet_new.csv — информация об интернет-услугах;
* phone_new.csv — информация об услугах телефонии.

Во всех файлах столбец customerID содержит код клиента.


Информация о договорах актуальна на 1 февраля 2020.


## Описание полей
* BeginDate - дата начала пользования услугами.
* EndDate - дата окончания пользования услугами.
* Type - тип оплаты: ежемесячный, годовой и т.д.
* PaperlessBilling - электронный платежный документ
* PaymentMethod - способ оплаты.
* MonthlyCharges - ежемесячные траты на услуги
* TotalCharges - всего потрачено денег на услуги
* Dependents - наличие иждивенцев
* Senior Citizen - наличие пенсионного статуса по возрасту
* Partner - наличие супруга(и)
* MultipleLines - наличие возможности ведения параллельных линий во время звонка.
* gender - пол клиента	


## Используемые инструменты

Pandas, Numpy, Matplotlib, Phik, Scipy, Sklearn, Seaborn


## План работы

1.	Первичное ознакомление с данными. Загрузить датафремы, провести первичный анализ данных. Наметить план дальнейшей работы с данными.
2.	Предобработка данных для анализа. Проверить и устранить наличие пропусков, явных дубликатов. Привести к необходимым типам данных. Сделать промежуточные выводы.
3.	Анализ данных. Провести исследование данных, проверить распределение, выявить есть аномальные выбросы и взаимосвязи между данными. Сформулировать промежуточные выводы.
4.	Подготовка данных к обучению. Выделение признаков и целевого для обучения. Разделение датасета на выборки, а также закодировать категориальные признаки.
5.	Анализ моделей. Подбор гиперпараметров, обучение и выбор наилучшей модели для тестирования.
6.	Тестирование. Проверка модели на тестовой выборке.
7.	Сформулировать общий вывод по результатам проведенного исследования.

## Вывод
### Первичный анализ и предобработка:

Названия столбцов были приведены к единому общепринятому стилю написания. Явных дубликатов и пропусков в столбцах не обнаружено. В столбце TotalCharges были обнаружены неявные пропуски в виде пробелов. Данные пропуски были заменены на нулевое значение.


Был создан единый датафрейм размером 12 столбцов и 7043 строк. Исходные данные объединили по столбцу CustomerId. Поскольку в датафреймах было разное количество данных, то после соединения образовались пропуски:

* информация об интеренет-услугах 1526 пропусков
* информация о телефонии 682 пропусков.	


Поскольку данные пропуски означали, что данные клиенты не пользуются этим видом услуг, то было принято решение заполнить их значениями 'No internet' и 'No phone' соответственно. В столбце 'EndDate' для действующих клиентов присутствовало значение 'No', которое было заменено датой актуальности данных и сформирован целевой признак:

* клиент ушел (1)
* клиент остался (0)	


Добавлен новый признак длительность контракта.


### Анализ данных:

* Количество клиентов, которые расторгли договор с компанией с 2015 по 2019 имеет небольшой ежегодный прирост. При этом с 2019 года наблюдается увеличение числа клиентов новых клиентов. При этом число действующих клиентов значительно превышает число оттока клиентов.
* Большинство клиентов не имеют детей и не достигли пенсионного возраста. Наиболее популярный тип договора с ежемесячной оплатой без использования дополнительных услуг. При этом клиенты предпочитают получать электронный платежный документ и с его помощью оплачивать предоставляемые услуги компании. Мужчин и женщин среди клиентов примерно поровну.
* Наиболее популярный способ подключения интернета - оптоволокно. Клиенты, использующие такой вид подключение интернета, чаще отказываются от услуг компании. Возможно, проблема в качестве предоставляемой услуги: низкая скорость интернета, плохая техподдержка.
* Клиенты, получающие электронный платежный документ чаще отказываются от услуг компании. Возможно, это связано с тем, что, получая и оплачивая услуги по безналу расчету подразумевает наличие личного кабинета, в котором можно легко расторгнуть договор. Гендерный признак не оказывает существенного влияния на отказ клиента от услуг компании., а вот наличие партнера повышает шансы отказа от услуг.
* С увеличением ежемесячного платежа шансы того, что клиент уйдет повышаются. Наблюдается повышенное число ушедших клиентов с минимальными ежемесячными затратами. Возможно, в этом числе имеются молодые люди (например, студенты), которые нашли компанию с наиболее выгодным предложением или более низкой стоимостью услуг.
* Сформулирована и подтверждена гипотеза, что в среднем клиенты отказываются от услуг компании в течении 3 лет с момента заключения договора.
* Построена матрица корреляции признаков, которая показала сильную взаимосвязь даты заключения контракта и длительности контракта, а также даты расторжения контракта и целевого признака. Так же наблюдается достаточно сильная взаимосвязь между собой некоторых признаков (например, ежемесячный платеж - итоговая сумма, ежемесячный платеж - дополнительные услуги). В результате этого было принято решение удалить столбцы с датами заключения-расторжения договора и итоговой суммой затрат.


### Подготовка данных к обучению:
* Данные разделены на обучающую и тестовую выборки в соотношении 3:1 (75% и 25%)
* Выделены признаки и целевой (type_client)
* В целевом признаке присутствует дисбаланс.
* Из-за присутствия категориальных признаков была проведена кодировка данных с применением метода TargetEncoder.	


### Обучение моделей и тестирование итоговой:


* Для обучения отобрали 5 моделей:
  * RandomForestClassifier
  * CatboostClassifier
  * LGBMClassifier
  * XGBClassifier
  * AdaBoostClassifier
	

* При обучении и подборе гиперпараметров применялись StandardScaler(), Pipeline() и GridSearch().


 * Все модели RandomForestClassifier и AdaBoostClassifier выдали наихудшие результаты среди всех моделей:
   * AUC-ROC для модели RandomForestClassifier - 0.820470
   * AUC-ROC для модели AdaBoostClassifier - 0.839191


* Данные результаты имеют значение ниже установленного значения AUC-ROC 0.85.


* Наилучшие результаты на обучающей выборке показала модель CatBoostClassifier (AUC-ROC - 0.926303). Данный результат был получен со следующими параметрами:

   * iterations : 500
   * depth : 3
   * learning_rate : 0.2
   * l2_leaf_reg : 1
   * random_state : 240323
   * cv : 5
        
* На тестовой выборке модель CatBoostClassifier с данными параметрами выдала результат:
   * AUC_ROC - 0.943905
   * Accuracy - 0.940943
   * F1 - 0.768889


Данные результаты удовлетворяют заявленным требованиям, поэтому ее можно рекомендовать клиенту для решения его бизнес-задачи.

