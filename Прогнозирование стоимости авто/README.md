# Прогнозирование стоимости автомобиля

## Содержание
1. Описание задачи
2. Описание данных
3. Используемые инструменты
4. План работы
5. [Вывод](https://github.com/avkrickaya/Portfolio/blob/main/Прогнозирование%20стоимости%20авто/README.md#вывод)

## Описание задачи
Необходимо построить модель для определения рыночной стоимости автомобиля с пробегом. В нашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей.

Заказчику важны:

* качество предсказания (RMSE > 2500);
* скорость предсказания;
* время обучения. 

## Описание данных

Датафрейм содержит следующую информацию:

* Дата скачивания анкеты из базы
* Тип автомобильного кузова
* Год регистрации автомобиля
* Тип коробки передач
* Мощность (л. с.)
* Модель автомобиля
* Пробег (км)
* Месяц регистрации автомобиля
* Тип топлива
* Марка автомобиля
* Была машина в ремонте или нет
* Дата создания анкеты
* Количество фотографий автомобиля
* Почтовый индекс владельца анкеты (пользователя)
* Дата последней активности пользователя
* Цена (евро)


## Используемые инструменты



## План работы
1. Первичное ознакомление с данными. Загрузить датафремы, провести первичный анализ данных. Наметить план дальнейшей работы с данными.
2.  Предобработка данных для анализа. Проверить и устранить наличие пропусков, явных дубликатов. Привести к необходимым типам данных. Сделать промежуточные выводы.
3. Анализ данных. Провести исследование данных, проверить распределение, выявить есть аномальные выбросы и взаимосвязи между данными. Сформулировать промежуточные выводы.
4. Подготовка данных к обучению. Выделение признаков и целевого для обучения. Разделение датасета на выборки, а также закодировать категориальные признаки.
5. Анализ моделей. Подбор гиперпараметров, обучение и выбор наилучшей модели для тестирования.
6. Тестирование. Проверка модели на тестовой выборке.
7. Сформулировать общий вывод по результатам проведенного исследования.

## Вывод
### Первичное ознакомление

* в датафрейме всего 354369 строк и 16 столбцов.
* В столбцах VehicleType, Gearbox, Model, FuelType и Repaired имеется большое количество пропусков. 
* В данных присутствует 4 явных дубликата.
* Столбцы DateCrawled, DateCreated, NumberOfPictures, PostalCode, RegistrationMonth и LastSeen не являются важными для исследования, т.к. их наличие никак не влияет на стоимость автомобиля.


### Предобработка данных.

В результате предобработки было сделано следующее:
* Были удалены столбцы DateCrawled, DateCreated, NumberOfPictures, PostalCode, RegistrationMonth и LastSeen не являются важными для исследования, т.к. их наличие никак не влияет на стоимость автомобиля.
* Наименования приведены к единому общепринятому стилю написания.
* Заполнены пропуски в столбцах VehicleType, Gearbox, Model, FuelType и Repaired. Заполнение пропусков осуществлялось группировкой данных по значениям других столбцов (бред, модель и год регистрации) и заполнение наиболее часто встречающимися значениями в них.

  
### Анализ данных.

В процессе анализа было обнаружено следующее:
1.	Наибольшей популярностью пользуются автомобили с типом кузова sedan, small, wagon, механической коробкой передач, с бензиновыми или газовыми двигателями.
2.	В данных о стоимости автомобиля, годе регистрации и мощности двигателя обнаружены аномальные значения. Например, в стоимости автомобиля есть авто с нулевой стоимостью, мощностью двигателя как у самолета (20 000 л.с.), или годом регистрации 1200 или 2800.
3.	Выявлена достаточно сильная корреляция между следующими признаками: бренд/модель, модель/тип коробки и модель/ мощность двигателя. Наличие столь сильной взаимосвязи вполне логично, т.к. каждый бренд выпускает свои модели со своими уникальными характеристиками.
4.	На стоимость автомобиля оказывают влияние следующие признаки: год регистрации и мощность двигателя. При исследовании взаимосвязи были выявлено, что стоимость автомобиля падала в период 1972-1973 гг. (плавное снижение стоимости) и резкое падение цены в период 2014-2016 гг. Это может быть взаимосвязано с кризисами тех времен. Так же было обнаружено увеличие стоимости автомобиля при увеличении мощности.

### Подготовка данных к обучению.

При подготовке данных к обучению было сделано следующее:
1.	Данные были разделены на 3 выборки(обучающую, валидационную и тестовую) в соотношение 60%, 20% и 20%. Выделен целевой признак и признаки.
2.	По условию задачи необходимо обучить для сравнения хотя бы одну модель не градиентным бустингом, то категориальные признаки были закодированы и сохранены в отдельную переменную для данной модели. Для кодировки применялся метод TargetEncoder. Поскольку у нас задача предсказания цены авто, целевая метка - цена авто, то каждое значение марки авто в нашем признаке brand кодируется средней ценой автомобиля данного бренда.

   
### Анализ моделей и тестирование итоговой модели
1. Для анализа выбрано 6 моделей обучения и подобранны параметры для них:
  * Линейная регрессия
  * Lasso
  * DecisionTreeRegressor
  * RandomForestRegressor
  * CatBoost
  * LightGBM

2.	В ходе исследования было установлено, что масштабирование признаков для линейных моделей не оказывает влияние на качество. Также эти модели выдали худший показатель RMSE среди всех:
  * RMSE LinearRegression - 2832.542229
  * RMSE Lasso - 2832.541538
3.	Модели RandomForestRegressor, CatBootsRegressor и LGBMRegressor имеют диапазон метрики RMSE от 1579 до 1792. Что является хорошим показателем (условием нашей задачи RMSE < 2500).
4.	CatBootsRegressor несмотря на наилучший показатель метрики RMSE очень долго обучается. Было выявлено, что на время обучения данной модели оказывает влияние внутреннее кодирование категориальных признаков. При обучении данной модели на кодированных категориальных признаках RMSE немного улучшается, а вот время обучения сильно уменьшается:
  * RMSE на не кодированных данных - 1601.685151
  * Время обучения на не кодированных категориальных признаках - 94.498470 секунд
  * RMSE на кодированных данных - 1596.682533
  * Время обучения на кодированных категориальных признаках - 20.915456 секунд
5.	Наиболее подходящей моделью по требованиям заказчика (качество предсказания, время обучения и время предсказания модели) является LightGBM:
  * качество предсказания (RMSE) - 1656.982036
  * время обучения модели - 0.367725 сек.
  * время предсказания модели - 0.050491 сек.


